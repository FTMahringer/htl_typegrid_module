{# templates/htl-grid-block.html.twig #}
{{ attach_library('htl_typegrid/grid') }}

{% set show_bundle_heading = bundles_data|length > 1 %}

<div class="htl-grid"
     style="--ft-grid-cols: {{ columns|default(3) }}; --ft-grid-rows: {{ rows|default(2) }};">
  {% for group in bundles_data %}
    {% if show_bundle_heading %}
      <h3 class="htl-grid__group">{{ group.bundle_label }}</h3>
    {% endif %}

    {% for item in group.nodes %}
      <article class="htl-card">
        {# Klickbare Overlay-Fläche auf der ganzen Card #}
        {% if item.url %}
          <a class="htl-card__overlay"
             href="{{ item.url }}"
             aria-label="{{ item.title }}"></a>
        {% endif %}

        {# Bildbereich – kommt direkt aus GridCardBuilder #}
        {% if item.image %}
          <figure class="htl-card__media">
            {{ item.image }}
          </figure>
        {% endif %}

        <div class="htl-card__body">
          <h4 class="htl-card__title">
            {% if item.url %}
              <a href="{{ item.url }}">{{ item.title }}</a>
            {% else %}
              {{ item.title }}
            {% endif %}
          </h4>

          {# Meta-Felder (Datum, Text-Teaser, etc.) #}
          {% if item.meta is not empty %}
            <div class="htl-card__meta">
              {% for row in item.meta %}
                {% if row is iterable and row.value is defined %}
                  <div class="htl-card__meta-row {{ row.class|default('') }}">
                    {{ row.value }} {# Render-Array von Drupal, NICHT |raw, NICHT in <p> packen #}
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}


        </div>
      </article>
    {% endfor %}
  {% endfor %}
</div>
